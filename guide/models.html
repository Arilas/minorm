<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Models | Minorm</title>
    <meta name="description" content="Minimal ORM for you node.js project">
    
    
    <link rel="preload" href="/minorm/assets/css/0.styles.dedcdfe4.css" as="style"><link rel="preload" href="/minorm/assets/js/app.202f15e2.js" as="script"><link rel="preload" href="/minorm/assets/js/7.dd473e3c.js" as="script"><link rel="prefetch" href="/minorm/assets/js/10.a876fc82.js"><link rel="prefetch" href="/minorm/assets/js/2.8c50750e.js"><link rel="prefetch" href="/minorm/assets/js/3.419c57b5.js"><link rel="prefetch" href="/minorm/assets/js/4.5832591d.js"><link rel="prefetch" href="/minorm/assets/js/5.8fb1b179.js"><link rel="prefetch" href="/minorm/assets/js/6.2decd2d4.js"><link rel="prefetch" href="/minorm/assets/js/8.c8257104.js"><link rel="prefetch" href="/minorm/assets/js/9.0dde5d86.js">
    <link rel="stylesheet" href="/minorm/assets/css/0.styles.dedcdfe4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/minorm/" class="home-link router-link-active"><!----> <span class="site-name">Minorm</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/minorm/guide/" class="nav-link router-link-active">Guide</a></div> <a href="https://github.com/Arilas/minorm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/minorm/guide/" class="nav-link router-link-active">Guide</a></div> <a href="https://github.com/Arilas/minorm" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/minorm/guide/installation.html" class="sidebar-link">Installation</a></li><li><a href="/minorm/guide/getting-started.html" class="sidebar-link">Getting Started</a></li><li><a href="/minorm/guide/repositories.html" class="sidebar-link">Repositories</a></li><li><a href="/minorm/guide/models.html" class="active sidebar-link">Models</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/minorm/guide/models.html#insertion-or-updating-the-model" class="sidebar-link">Insertion or Updating the model</a></li><li class="sidebar-sub-header"><a href="/minorm/guide/models.html#state-helpers" class="sidebar-link">State helpers</a></li><li class="sidebar-sub-header"><a href="/minorm/guide/models.html#remove" class="sidebar-link">Remove</a></li><li class="sidebar-sub-header"><a href="/minorm/guide/models.html#refresh" class="sidebar-link">Refresh</a></li></ul></li><li><a href="/minorm/guide/query-builder.html" class="sidebar-link">Query Builder</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="models"><a href="#models" aria-hidden="true" class="header-anchor">#</a> Models</h1> <p>A Model is an object with attached helpers.</p> <p>In this article, we will use the same posts table which have fields: id, title, and creator_id.</p> <h2 id="insertion-or-updating-the-model"><a href="#insertion-or-updating-the-model" aria-hidden="true" class="header-anchor">#</a> Insertion or Updating the model</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> post <span class="token operator">=</span> repo<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> <span class="token string">'foo'</span><span class="token punctuation">,</span>
  creator_id<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">await</span> post<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
</code></pre></div><p>In the example above we inserted record and receiver id of post. If we need to update the same record we can use:</p> <div class="language-js extra-class"><pre class="language-js"><code>post<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'bar'</span>
<span class="token keyword">await</span> post<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>So we directly changed property and called a save method. Please note that the model can have other fields that are not represented in the database, and minorm will just ignore them. For example, let's create a model and save it with non-existing fields:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> post <span class="token operator">=</span> repo<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> <span class="token string">'Foo'</span><span class="token punctuation">,</span>
  creator_id<span class="token punctuation">:</span> user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
  creator<span class="token punctuation">:</span> user<span class="token punctuation">,</span>
  signature<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>firstName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>lastName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">await</span> post<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>post<span class="token punctuation">.</span>signature<span class="token punctuation">)</span>
</code></pre></div><p>As is described at the beginning of this article there's no any creator object or signature fields in the original table and minorm knows it, so it compares only known columns to calculate changes needed to be inserted or updated.</p> <p>This can be useful for returning result from the server or for having some hierarchy data.</p> <p>If you need to populate fetched model with a data you can also use <code>populate()</code> method. For example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> post <span class="token operator">=</span> repo<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>post <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  post<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">'some'</span><span class="token punctuation">,</span>
    creator_id<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> post<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="state-helpers"><a href="#state-helpers" aria-hidden="true" class="header-anchor">#</a> State helpers</h2> <p>There's two methods <code>isDirty()</code> and <code>getChanges()</code> that can be used to determine the state of the Model.</p> <ul><li><code>isDirty()</code> returns boolean that can tells you that there's some changes in a model that needs to be saved</li> <li><code>getChanges()</code> returns an object containing all fields that was changed from original state</li></ul> <h2 id="remove"><a href="#remove" aria-hidden="true" class="header-anchor">#</a> Remove</h2> <p>If you need to remove record from the database you can use <code>remove()</code> method on it. For example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token keyword">await</span> repo<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>post <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> post<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="refresh"><a href="#refresh" aria-hidden="true" class="header-anchor">#</a> Refresh</h2> <p>If you need to refresh the state of a model you can use <code>refresh()</code> method. If will fetch record from the database and update your model. It's useful when you have some fields that can be populated by <code>INSERT</code> or <code>UPDATE</code> in database, these changes is not basically reflected after <code>save()</code> execution</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/minorm/guide/repositories.html" class="prev">
          Repositories
        </a></span> <span class="next"><a href="/minorm/guide/query-builder.html">
          Query Builder
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/minorm/assets/js/app.202f15e2.js" defer></script><script src="/minorm/assets/js/7.dd473e3c.js" defer></script>
  </body>
</html>
